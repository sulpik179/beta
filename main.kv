#:import AnswerButton gui.widgets.answer_button.AnswerButton
#:import LanguageSelectPopup gui.utils.lang_popup.LanguageSelectPopup
#:import RoundedRectangle kivy.graphics.vertex_instructions.RoundedRectangle
#:import Color kivy.graphics.context_instructions.Color
#:import RoundedButton gui.widgets.rounded_button.RoundedButton

###############################################################################
#                               COLOR HELPERS
###############################################################################


<Label>:
    text_size: self.width, None
    halign: "center"
    valign: "middle"

###############################################################################
#                                POPUP — LANGUAGE
###############################################################################

<LanguageSelectPopup>:
    title: ""
    separator_height: 0
    background: ""
    background_color: 0, 0, 0, 0
    size_hint: 0.7, 0.28
    auto_dismiss: False

    canvas.before:
        Color:
            rgba: 0, 0, 0, 0   # ← ТВОЙ ФОН
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        id: main_box
        orientation: "vertical"
        padding: "30dp"
        spacing: "10dp"

        RoundedButton:
            text: "en - ru"
            font_name: "JetBrainsMono"
            background_normal: ""
            background_down: ""
            background_color: 0.21, 0.24, 0.26, 1
            color: 0.95, 0.96, 0.98, 1
            font_size: "20sp"
            height: "40dp"
            radius: [20]
            size_hint_y: None
            on_press: root._on_select("en_ru")

        Button:
            text: "ru - en"
            font_name: "JetBrainsMono"
            background_normal: ""
            background_down: ""
            background_color: 0.21, 0.24, 0.26, 1 
            color: 0.95, 0.96, 0.98, 1
            font_size: "20sp"
            height: "40dp"
            size_hint_y: None
            on_press: root._on_select("ru_en")

###############################################################################
#                                 MAIN SCREEN
###############################################################################

<MainScreen>:
    name: "main"

    FloatLayout:
        canvas.before:
            Color:
                rgba: app.color_dark if app.is_dark_theme else app.color_light
            Rectangle:
                pos: self.pos
                size: self.size

        Button:
            text: "O" if app.is_dark_theme else "X"
            color:  (0.90, 0.93, 0.96, 1) if app.is_dark_theme else (0.05, 0.06, 0.07, 1)
            font_name: "JetBrainsMono"
            font_size: "20sp"
            background_color: 0.62, 0.71, 0.75, 0
            size_hint: None, None
            size: "50dp", "50dp"
            pos_hint: {"x": 0.02, "top": 0.98}
            on_press: app.toggle_theme()


        BoxLayout:
            orientation: "vertical"
            padding: ("20dp", "45dp")
            spacing: "18dp"
            size_hint: 0.9, 0.8
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

            Label:
                text: "Welcome to Beta"
                font_name: "JetBrainsMono"
                color:  (0.90, 0.93, 0.96, 1) if app.is_dark_theme else (0.05, 0.06, 0.07, 1)
                font_size: "30sp"
                size_hint_y: None
                height: "55dp"

            Button:
                text: "Learn"
                font_name: "JetBrainsMono"
                background_color: 0.62, 0.71, 0.75, 1 
                color: 0.95, 0.96, 0.98, 1
                font_size: "24sp"
                height: "65dp"
                size_hint_y: None
                on_press: app.root.current = "learn"

            Button:
                text: "Practice"
                font_name: "JetBrainsMono"
                font_size: "24sp"
                background_color: 0.62, 0.71, 0.75, 1 
                color: 0.95, 0.96, 0.98, 1
                height: "65dp"
                size_hint_y: None
                on_press: app.root.current = "practice"

            Button:
                text: "Dictionary"
                font_name: "JetBrainsMono"
                font_size: "24sp"
                background_color: 0.62, 0.71, 0.75, 1 
                color: 0.95, 0.96, 0.98, 1
                height: "65dp"
                size_hint_y: None
                on_press: app.root.current = "dictionary"


###############################################################################
#                            CARD TEMPLATE
###############################################################################

<CardContainer@BoxLayout>:
    orientation: "vertical"
    spacing: "15dp"
    padding: "15dp"
    size_hint_y: None
    height: self.minimum_height

    canvas.before:
        Color:
            rgba: app.color_dark if app.is_dark_theme else app.color_light
        Rectangle:
            pos: self.pos
            size: self.size

###############################################################################
#                                 LEARN SCREEN
###############################################################################

<LearnScreen>:
    name: "learn"

    FloatLayout:

        canvas.before:
            Color:
                rgba: app.color_dark if app.is_dark_theme else app.color_light
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            orientation: "vertical"
            spacing: "10dp"
            padding: "5dp"
            size_hint: 0.95, 0.9
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

            CardContainer:
                Label:
                    id: word_label
                    font_name: "JetBrainsMono"
                    font_size: "20sp"
                    height: "45dp"
                    size_hint_y: None
                Label:
                    id: transcription_label
                    font_name: "DejaVuSans"
                    font_size: "16sp"
                    height: "38dp"
                    size_hint_y: None
                Label:
                    id: sentence_label
                    font_name: "JetBrainsMono"
                    font_size: "17sp"
                    height: "55dp"
                    size_hint_y: None

            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"
                padding: "5dp"
                size_hint_y: None
                height: "200dp"

                AnswerButton:
                    id: option1
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "18sp"
                    height: "57dp"
                    size_hint_y: None
                    on_press: root.check_answer(self.text)

                AnswerButton:
                    id: option2
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "18sp"
                    height: "57dp"
                    size_hint_y: None
                    on_press: root.check_answer(self.text)

                AnswerButton:
                    id: option3
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "18sp"
                    height: "57dp"
                    size_hint_y: None
                    on_press: root.check_answer(self.text)

            BoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                padding: "5dp"
                size_hint_y: None
                height: "60dp"

                Button:
                    text: "<-"
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "20sp"
                    on_press: app.root.current = "main"

                Button:
                    id: next_button
                    text: "->"
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "20sp"
                    disabled: True
                    opacity: 0
                    on_press: root.next_word()

###############################################################################
#                                PRACTICE SCREEN
###############################################################################

<PracticeScreen>:
    name: "practice"

    FloatLayout:

        canvas.before:
            Color:
                rgba: app.color_dark if app.is_dark_theme else app.color_light
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            id: progress_label
            font_name: "JetBrainsMono"
            font_size: "12sp"
            color: 0.37, 0.42, 0.47, 1
            size_hint: None, None
            pos_hint: {"right": 0.97, "top": 0.995}

        BoxLayout:
            orientation: "vertical"
            spacing: "10dp"
            padding: "5dp"
            size_hint: 0.95, 0.9
            pos_hint: {"center_x": 0.5, "center_y": 0.5}

            CardContainer:
                Label:
                    id: word_label
                    font_name: "JetBrainsMono"
                    font_size: "20sp"
                    height: "45dp"
                    size_hint_y: None
                Label:
                    id: transcription_label
                    font_name: "DejaVuSans"
                    font_size: "16sp"
                    height: "38dp"
                    size_hint_y: None
                Label:
                    id: sentence_label
                    font_name: "JetBrainsMono"
                    font_size: "17sp"
                    height: "55dp"
                    size_hint_y: None

            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"
                padding: "5dp"
                size_hint_y: None
                height: "200dp"

                AnswerButton:
                    id: option1
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "18sp"
                    height: "57dp"
                    size_hint_y: None
                    on_press: root.check_answer(self.text)

                AnswerButton:
                    id: option2
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "18sp"
                    height: "57dp"
                    size_hint_y: None
                    on_press: root.check_answer(self.text)

                AnswerButton:
                    id: option3
                    font_name: "JetBrainsMono"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_size: "18sp"
                    height: "57dp"
                    size_hint_y: None
                    on_press: root.check_answer(self.text)

            BoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                padding: "5dp"
                size_hint_y: None
                height: "60dp"

                Button:
                    text: "<-"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_name: "JetBrainsMono"
                    font_size: "20sp"
                    on_press: app.root.current = "main"

                Button:
                    id: next_button
                    text: "->"
                    background_color: 0.62, 0.71, 0.75, 1
                    color: 0.95, 0.96, 0.98, 1
                    font_name: "JetBrainsMono"
                    font_size: "20sp"
                    disabled: True
                    opacity: 0
                    on_press: root.next_word()

###############################################################################
#                                   DICTIONARY
###############################################################################

<DictionaryScreen>:
    name: "dictionary"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            size_hint: 1, None
            height: "70dp"
            padding: "10dp"
            spacing: "10dp"
            pos_hint: {"top": 1}

            Button:
                text: "<-"
                font_name: "JetBrainsMono"
                font_size: "24sp"
                background_color: 0.21, 0.24, 0.26, 1
                background_normal: ""
                color: 0.95, 0.96, 0.98, 1
                size_hint: None, None
                size: "50dp", "50dp"
                on_press: app.root.current = "main"

        ScrollView:
            size_hint_y: 1
            bar_width: "6dp"

            GridLayout:
                id: dict_layout
                cols: 1
                spacing: "14dp"
                padding: "14dp"
                size_hint_y: None
                height: self.minimum_height

<DictionaryItem@BoxLayout>:
    orientation: "vertical"
    size_hint_y: None
    padding: "5dp"
    spacing: "4dp"
    height: self.minimum_height

    canvas.before:
        Color:
            rgba: (0.90, 0.93, 0.96, 1) if app.is_dark_theme else (0.05, 0.06, 0.07, 1)
        Line:
            points: [self.x, self.top, self.right, self.top]
            width: 1

    Label:
        id: main_label
        font_name: "JetBrainsMono"
        font_size: "15sp"
        halign: "left"
        color: 0.95, 0.96, 0.98, 1 if app.is_dark_theme else (0.11, 0.14, 0.15, 1)
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]

    Label:
        id: transcr_label
        font_name: "DejaVuSans"
        font_size: "13sp"
        halign: "left"
        color: 0.75, 0.78, 0.80, 1
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]


###############################################################################
#                             SCREEN MANAGER
###############################################################################

<FlashcardScreenManager>:
    MainScreen:
    LearnScreen:
    PracticeScreen:
    DictionaryScreen:
